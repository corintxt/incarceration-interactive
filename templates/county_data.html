{% extends "layout.html" %}

{% block content %}

<div class="chart-header text-center">
    <h1>
      State: {{ session.get('current_state') }}
    </h1>
    <h2>
      County: {{ session.get('current_county') }}
    </h2>
  </div>

<div class="chart-container">

  <div class="charts text-center">
    <div class="row"><div id="map"></div></div>
    <div id="vis-tooltip" class="vg-tooltip"></div>
  </div>

  <!-- County info section -->
  <div class="charts text-center">
    <div class="row"><div id="info">
      <h2>Statistics</h2>
      <div class="chart-description">
        <p>State population (2016): <strong> {{ state_pop }} </strong></p>
        <p>County population (2016): <strong> {{ total_population }}</strong></p>        
        <p>Number of prison facilities disclosed (2016): <strong>{{ session.get('num_facilities') }}</strong></p>
        <p>Reported prison capacity (2016): <strong>{{ session.get('capacity') }}</strong></p>
    </div></div>
  </div>

  <hr>

  <div class="text-center">
      <h2>Prisons vs Jails</h2>
  </div>
  <div class="text-center chart-description">
    <p>First we will provide some introductory information on the difference between
       prisons and jails.</p>
    <p>Across the U.S., there were <a href="https://www.vera.org/publications/people-in-prison-in-2018">450 people in prison for every 100,000 residents in 2018</a>. 
      This compares to [DATA] in China, and [DATA] in Sweden.</p>  
  </div>

  <hr>

  <div class="text-center">
      <h2>Incarceration data</h2>
  </div>

  <div id="bar-container">
    <div class="text-center chart-description">
        <p>The charts below shows the change in prison and jail population in <strong>{{ session.get('current_county') }}</strong> over time.</p>

        {% if session.get('prison_data_exists') %}
            <p>The prison population in <strong>{{ session.get('current_county') }}</strong> reached its peak 
            in <strong>{{ max_prison_pop_year }}</strong> with <strong>{{ max_prison_pop }}</strong> inmates.</p>
        {% else %}
            <p>Prison data is not available for {{ session.get('current_county') }}.</p>
        {% endif %}

        {% if session.get('jail_data_exists') %}
          <p>The jail population in <strong>{{ session.get('current_county') }}</strong> reached its peak in <strong>{{ max_jail_pop_year }}</strong> with <strong>{{ max_jail_pop }}</strong> inmates.</p>  
          <p>The <span class='orange'>orange</span> bars show the proportion of the jail population that is <span class='orange'>pre-trial</span>, i.e. 
          charged with a crime but awaiting a court date. (These are typically people who are 
          <a href='https://www.nytimes.com/2019/01/11/nyregion/how-does-bail-work-and-why-do-people-want-to-get-rid-of-it.html'>too poor to post bail</a>).</p>
        {% else %}
          <p>Jail data is not available for {{ session.get('current_county') }}.</p>
        {% endif %}
    </div>

    {% if session.get('prison_data_exists') %}
      <div class="charts text-center">
        <div class="row"><div id="bar_prison"></div></div>
        <div id="vis-tooltip" class="vg-tooltip"></div>
      </div>
    {% endif %}


    {% if session.get('jail_data_exists') %}
      <div class="charts text-center">
        <div class="row"><div id="bar_jail"></div></div>
        <div id="vis-tooltip" class="vg-tooltip"></div>
      </div> 
    {% endif %}     
  </div>

  <hr>
  
  <div class="text-center">
      <h2>Demographics</h2>
  </div>
  <div class="text-center chart-description">
      <p>Across the U.S., black people are incarcerated at disproportionately high rates relative to the general population.</p> 
      <p>The first chart above shows the relative proportion of white to black residents in the population of <strong>{{ session.get('current_county') }} </strong>.</p>
      <p>The next two charts show the proportion of white to black inmates in the jail and prison population respectively, starting with the earliest year for which data is reported.
      </p>
    </div>
  <div class="charts text-center">
    <div class="row"><div id="multiline"></div></div>
    <div id="vis-tooltip" class="vg-tooltip"></div>
  </div>

  <hr>

  <div class="text-center">
<<<<<<< HEAD
=======
      <h2>Pre-trial jail</h2>
  </div>  
  <div class="text-center chart-description">
      <p>[More details to come - context on bail bonds, poverty & jail].</p>
    </div>
  <div class="charts text-center">
      <div class="row"><div id="pretrial"></div></div>
      <div id="vis-tooltip" class="vg-tooltip"></div>
  </div>
  <hr>

  <div class="text-center">
>>>>>>> added bool variable capturing whether jail data exists
    <h2>State level comparison</h2>
</div>
<div class="text-center chart-description">
    <p>The chart below shows the prison population compared to total population
      for each county in <strong>{{ session.get('current_state') }}</strong> state. 
      Data for <strong>{{ session.get('current_county') }} </strong> is highlighted by a square box.

    </p>
    <p>Hovering over a dot provides additional information. Use the mouse wheel to zoom in and out of the chart.</p>
    <p><em>(NB: A null value for total prison population on this chart indicates that the state
      declined to provide the requested information.)</em></p>
  </div>
<div class="charts text-center">
    <div class="row"><div id="scatter"></div></div>
    <div id="vis-tooltip" class="vg-tooltip"></div>
</div>

<hr>

<div class="text-center">
    <h2>Crime statistics</h2>
</div>  
<div class="text-center chart-description">
    <p>The chart below shows reported crime figures for <strong>{{session.get('current_county')}}</strong>.</p>
    <p>The larger the circle, the more crimes of this type were reported in a given year.</p>
    <p>[Add a little more description].</p>
  </div>
<div class="charts text-center">
    <div class="row"><div id="crime"></div></div>
    <div id="vis-tooltip" class="vg-tooltip"></div>
</div>

<hr>

  <div class="charts text-center">
      <div class="row">
        <a href="/select" class="btn btn-secondary" id="view-another" role="button">View another county</a>
      </div>
  </div>
  
</div>

<!-- Render Charts -->
<script type="text/javascript">

  function parse(url, div) {
    var opt = {
      mode: "vega-lite",
      renderer: "svg",
      actions: {export: true, source: false, editor: false}
    };

    vegaEmbed("#"+div, url, opt, function(error, result) {
      // result.view is the Vega View, url is the original Vega-Lite specification
      vegaTooltip.vegaLite(result.view, url);
  
    });
  }
  
    //tells vega where to find the JSON for each chart type
    parse("/bar_prison", "bar_prison")
    parse("/bar_jail", "bar_jail")
    parse("/multiline", "multiline")
    parse("/crime", "crime")
    parse("/map", "map")
    parse("/scatter", "scatter")

</script>

{% endblock %}